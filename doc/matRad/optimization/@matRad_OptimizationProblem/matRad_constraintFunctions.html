<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of matRad_constraintFunctions</title>
  <meta name="keywords" content="matRad_constraintFunctions">
  <meta name="description" content="matRad IPOPT callback: constraint function for inverse planning">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html matRad --><!-- ../menu.html optimization --><!-- menu.html @matRad_OptimizationProblem -->
<h1>matRad_constraintFunctions
</h1>

<h2><a name="_name"></a>Purpose <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box">matRad IPOPT callback: constraint function for inverse planning</div>

<h2><a name="_synopsis"></a>Synopsis <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box">function c = matRad_constraintFunctions(optiProb,w,dij,cst) </div>

<h2><a name="_description"></a>Description <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> matRad IPOPT callback: constraint function for inverse planning 
 supporting max dose constraint, min dose constraint, min mean dose constraint, 
 max mean dose constraint, min EUD constraint, max EUD constraint, 
 max DVH constraint, min DVH constraint 
 
 call
   c = matRad_constraintFunctions(optiProb,w,dij,cst)

 input
   optiProb:   option struct defining the type of optimization
   w:          bixel weight vector
   dij:        dose influence matrix
   cst:        matRad cst struct

 output
   c:          value of constraints

 References
   -

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 Copyright 2016 the matRad development team. 
 
 This file is part of the matRad project. It is subject to the license 
 terms in the LICENSE file found in the top-level directory of this 
 distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part 
 of the matRad project, including this file, may be copied, modified, 
 propagated, or distributed except according to the terms contained in the 
 LICENSE file.

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>Cross-reference information <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-type:disc">
</ul>
This function is called by:
<ul style="list-style-type:disc">
<li><a href="../../../matRad/optimization/@matRad_OptimizationProblemDAO/matRad_constraintFunctions.html" class="code" title="function c = matRad_constraintFunctions(optiProb,apertureInfoVec,dij,cst)">matRad_constraintFunctions</a>	matRad IPOPT callback: constraint function for direct aperture optimization</li><li><a href="matRad_OptimizationProblem.html" class="code" title="">matRad_OptimizationProblem</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>Source code <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function c = matRad_constraintFunctions(optiProb,w,dij,cst)</a>
0002 <span class="comment">% matRad IPOPT callback: constraint function for inverse planning</span>
0003 <span class="comment">% supporting max dose constraint, min dose constraint, min mean dose constraint,</span>
0004 <span class="comment">% max mean dose constraint, min EUD constraint, max EUD constraint,</span>
0005 <span class="comment">% max DVH constraint, min DVH constraint</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% call</span>
0008 <span class="comment">%   c = matRad_constraintFunctions(optiProb,w,dij,cst)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% input</span>
0011 <span class="comment">%   optiProb:   option struct defining the type of optimization</span>
0012 <span class="comment">%   w:          bixel weight vector</span>
0013 <span class="comment">%   dij:        dose influence matrix</span>
0014 <span class="comment">%   cst:        matRad cst struct</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% output</span>
0017 <span class="comment">%   c:          value of constraints</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% References</span>
0020 <span class="comment">%   -</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Copyright 2016 the matRad development team.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% This file is part of the matRad project. It is subject to the license</span>
0027 <span class="comment">% terms in the LICENSE file found in the top-level directory of this</span>
0028 <span class="comment">% distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part</span>
0029 <span class="comment">% of the matRad project, including this file, may be copied, modified,</span>
0030 <span class="comment">% propagated, or distributed except according to the terms contained in the</span>
0031 <span class="comment">% LICENSE file.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0034 
0035 
0036 <span class="comment">% get current dose / effect / RBExDose vector</span>
0037 <span class="comment">%d = matRad_backProjection(w,dij,optiProb);</span>
0038 optiProb.BP = optiProb.BP.compute(dij,w);
0039 d = optiProb.BP.GetResult();
0040 
0041 <span class="comment">% Initializes constraints</span>
0042 c = [];
0043 
0044 <span class="comment">% compute objective function for every VOI.</span>
0045 <span class="keyword">for</span>  i = 1:size(cst,1)
0046 
0047     <span class="comment">% Only take OAR or target VOI.</span>
0048     <span class="keyword">if</span> ~isempty(cst{i,4}{1}) &amp;&amp; ( isequal(cst{i,3},<span class="string">'OAR'</span>) || isequal(cst{i,3},<span class="string">'TARGET'</span>) )
0049 
0050         <span class="comment">% loop over the number of constraints for the current VOI</span>
0051         <span class="keyword">for</span> j = 1:numel(cst{i,6})
0052             
0053             obj = cst{i,6}{j};
0054             
0055             <span class="comment">% only perform computations for constraints</span>
0056             <span class="comment">% if ~isempty(strfind(obj.type,'constraint'))</span>
0057             <span class="keyword">if</span> isa(obj,<span class="string">'DoseConstraints.matRad_DoseConstraint'</span>)
0058                 
0059                 <span class="comment">% if we have effect optimization, temporarily replace doses with effect</span>
0060                 <span class="comment">% Maybe we should put some switch into the classes for that</span>
0061                 <span class="keyword">if</span> (~isequal(obj.name, <span class="string">'max dose constraint'</span>)      &amp;&amp; ~isequal(obj.name, <span class="string">'min dose constraint'</span>)      &amp;&amp;<span class="keyword">...</span>
0062                     ~isequal(obj.name, <span class="string">'max mean dose constraint'</span>) &amp;&amp; ~isequal(obj.name, <span class="string">'min mean dose constraint'</span>) &amp;&amp; <span class="keyword">...</span>
0063                     ~isequal(obj.name, <span class="string">'min EUD constraint'</span>)       &amp;&amp; ~isequal(obj.name, <span class="string">'max EUD constraint'</span>))     &amp;&amp; <span class="keyword">...</span>
0064                     (isa(optiProb.BP,<span class="string">'matRad_EffectProjection'</span>) &amp;&amp; ~isa(optiProb.BP,<span class="string">'matRad_VariableRBEProjection'</span>))
0065                     
0066                     doses = obj.getDoseParameters();
0067                     
0068                     effect = cst{i,5}.alphaX*doses + cst{i,5}.betaX*doses.^2;
0069                     
0070                     obj = obj.setDoseParameters(effect);
0071                 <span class="keyword">end</span>
0072 
0073                 <span class="comment">% if conventional opt: just add constraints of nominal dose</span>
0074                 <span class="comment">%if strcmp(cst{i,6}(j).robustness,'none')</span>
0075 
0076                     d_i = d{1}(cst{i,4}{1});
0077 
0078                     <span class="comment">%c = [c; matRad_constFunc(d_i,cst{i,6}(j),d_ref)];</span>
0079                     c = [c; obj.computeDoseConstraintFunction(d_i)];
0080                     
0081                 <span class="comment">%else</span>
0082                     
0083                     <span class="comment">%error('Invalid robustness setting.');</span>
0084 
0085                 <span class="comment">%end % if we are in the nominal sceario or rob opt</span>
0086             
0087             <span class="keyword">end</span> <span class="comment">% if we are a constraint</span>
0088 
0089         <span class="keyword">end</span> <span class="comment">% over all defined constraints &amp; objectives</span>
0090 
0091     <span class="keyword">end</span> <span class="comment">% if structure not empty and oar or target</span>
0092 
0093 <span class="keyword">end</span> <span class="comment">% over all structures</span></pre></div>
<hr><address><a href="https://e0404.github.io/matRad/" target="_parent"><img src="https://camo.githubusercontent.com/0a593ef6a04757c975b9f4634f6731ea0b019bbd/68747470733a2f2f7261776769742e636f6d2f77696b692f65303430342f6d61745261642f696d616765732f6d61747261645f626c616e6b2e737667" height="12px"/></a> | Generated by  <a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>