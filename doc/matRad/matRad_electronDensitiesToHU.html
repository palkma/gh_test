<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of matRad_electronDensitiesToHU</title>
  <meta name="keywords" content="matRad_electronDensitiesToHU">
  <meta name="description" content="matRad function to calculate recalculate HU values from equivalent densities">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html matRad -->
<h1>matRad_electronDensitiesToHU
</h1>

<h2><a name="_name"></a>Purpose <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box">matRad function to calculate recalculate HU values from equivalent densities</div>

<h2><a name="_synopsis"></a>Synopsis <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box">function ct = matRad_electronDensitiesToHU(ct) </div>

<h2><a name="_description"></a>Description <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> matRad function to calculate recalculate HU values from equivalent densities 
 This is done to provide downward compatability to previous matRad 
 versions where HU values were not automatically saved during the
 import process. HU values can only be calculated if the HLUT is
 bijective.

 call
   ct = matRad_electronDensitiesToHU(ct)

 input
   ct: matRad ct struct containing cube and all additional information

 output
   ct: ct struct with HU and equivalent density cube

 References
   -

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 Copyright 2015 the matRad development team. 
 
 This file is part of the matRad project. It is subject to the license 
 terms in the LICENSE file found in the top-level directory of this 
 distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part 
 of the matRad project, including this file, may be copied, modified, 
 propagated, or distributed except according to the terms contained in the 
 LICENSE file.

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>Cross-reference information <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-type:disc">
<li><a href="../matRad/dicom/matRad_loadHLUT.html" class="code" title="function hlut = matRad_loadHLUT(ct, pln)">matRad_loadHLUT</a>	matRad function to load HLUT file based on the provided ct</li></ul>
This function is called by:
<ul style="list-style-type:disc">
<li><a href="matRadGUI.html" class="code" title="function varargout = matRadGUI(varargin)">matRadGUI</a>	matRad GUI</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>Source code <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function ct = matRad_electronDensitiesToHU(ct)</a>
0002 <span class="comment">% matRad function to calculate recalculate HU values from equivalent densities</span>
0003 <span class="comment">% This is done to provide downward compatability to previous matRad</span>
0004 <span class="comment">% versions where HU values were not automatically saved during the</span>
0005 <span class="comment">% import process. HU values can only be calculated if the HLUT is</span>
0006 <span class="comment">% bijective.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% call</span>
0009 <span class="comment">%   ct = matRad_electronDensitiesToHU(ct)</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% input</span>
0012 <span class="comment">%   ct: matRad ct struct containing cube and all additional information</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% output</span>
0015 <span class="comment">%   ct: ct struct with HU and equivalent density cube</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% References</span>
0018 <span class="comment">%   -</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Copyright 2015 the matRad development team.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% This file is part of the matRad project. It is subject to the license</span>
0025 <span class="comment">% terms in the LICENSE file found in the top-level directory of this</span>
0026 <span class="comment">% distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part</span>
0027 <span class="comment">% of the matRad project, including this file, may be copied, modified,</span>
0028 <span class="comment">% propagated, or distributed except according to the terms contained in the</span>
0029 <span class="comment">% LICENSE file.</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0032 
0033 
0034 
0035 <span class="comment">% load hlut</span>
0036 <span class="keyword">if</span> isfield(ct,<span class="string">'hlut'</span>) <span class="comment">% if hlut stored upon import use this one!</span>
0037     hlut = ct.hlut;
0038 <span class="keyword">else</span>
0039     hlut = <a href="../matRad/dicom/matRad_loadHLUT.html" class="code" title="function hlut = matRad_loadHLUT(ct, pln)">matRad_loadHLUT</a>(ct);
0040 <span class="keyword">end</span>
0041 
0042 <span class="comment">% interpolate rel. electron dens. to HU based on lookup table</span>
0043 <span class="keyword">if</span> isequal(hlut(:,2),unique(hlut(:,2))) &amp;&amp; isequal(hlut(:,1),unique(hlut(:,1)))
0044 
0045     <span class="keyword">for</span> i = 1:ct.numOfCtScen
0046         <span class="comment">% Manual adjustments if ct data is corrupt. If some values are out of range</span>
0047         <span class="comment">% of the LUT, then these values are adjusted.</span>
0048         <span class="keyword">if</span> max(ct.cube{i}(:)) &gt; max(hlut(:,2))
0049             warning(<span class="string">'projecting out of range electron density values'</span>);
0050             ct.cube{i}(ct.cube{i}(:) &gt; max(hlut(:,2))) = max(hlut(:,2));
0051         <span class="keyword">end</span>
0052         <span class="keyword">if</span> min(ct.cube{i}(:)) &lt; min(hlut(:,2))
0053             warning(<span class="string">'projecting out of range electron density values'</span>);
0054             ct.cube{i}(ct.cube{i}(:) &lt; min(hlut(:,2))) = min(hlut(:,2));
0055         <span class="keyword">end</span>
0056 
0057         ct.cubeHU{i} = interp1(hlut(:,2),hlut(:,1),ct.cube{i});
0058     <span class="keyword">end</span>
0059     
0060 <span class="keyword">else</span>
0061     fprintf(<span class="string">'Reconversion of HU values could not be done because HLUT is not bijective.\n'</span>);
0062 <span class="keyword">end</span></pre></div>
<hr><address><a href="https://e0404.github.io/matRad/" target="_parent"><img src="https://camo.githubusercontent.com/0a593ef6a04757c975b9f4634f6731ea0b019bbd/68747470733a2f2f7261776769742e636f6d2f77696b692f65303430342f6d61745261642f696d616765732f6d61747261645f626c616e6b2e737667" height="12px"/></a> | Generated by  <a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>