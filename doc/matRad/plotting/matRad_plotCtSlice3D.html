<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of matRad_plotCtSlice3D</title>
  <meta name="keywords" content="matRad_plotCtSlice3D">
  <meta name="description" content="matRad function that generates the plot for the CT in the GUI 3D view">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html matRad --><!-- menu.html plotting -->
<h1>matRad_plotCtSlice3D
</h1>

<h2><a name="_name"></a>Purpose <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box">matRad function that generates the plot for the CT in the GUI 3D view</div>

<h2><a name="_synopsis"></a>Synopsis <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box">function [ctHandle,cMap,window] = matRad_plotCtSlice3D(axesHandle,ct,cubeIdx,plane,ctSlice,cMap,window) </div>

<h2><a name="_description"></a>Description <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> matRad function that generates the plot for the CT in the GUI 3D view 
 The function can also be used in personal matlab figures by passing the
 corresponding axes handle

 call
   [ctHandle,cMap,window] = matRad_plotCtSlice3D(axesHandle,ct,cubeIdx,plane,ctSlice,cMap,window)

 input
   axesHandle  handle to 3D axes the slice should be displayed in
   ct          the ct struct used in matRad
   cubeIdx     Index of the desired cube in the ct struct
   plane       plane view (coronal=1,sagittal=2,axial=3)
   ctSlice     slice in the selected plane of the 3D cube
   cMap        optional argument defining the colormap, default is bone
               if you want to use the default map with the window argument
               you can use an empty array []
   window      optional argument defining the displayed range. default is
               [min(ctCube(:)) max(ctCube(:))]

 output
   ctHandle    handle of the plotted CT axes
   cMap        used colormap (same as input if set)
   window      used window (same as input if set)

 References
   -

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

 Copyright 2015 the matRad development team. 
 
 This file is part of the matRad project. It is subject to the license 
 terms in the LICENSE file found in the top-level directory of this 
 distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part 
 of the matRad project, including this file, may be copied, modified, 
 propagated, or distributed except according to the terms contained in the 
 LICENSE file.

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>Cross-reference information <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-type:disc">
</ul>
This function is called by:
<ul style="list-style-type:disc">
<li><a href="../../matRad/matRadGUI.html" class="code" title="function varargout = matRadGUI(varargin)">matRadGUI</a>	matRad GUI</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>Source code <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [ctHandle,cMap,window] = matRad_plotCtSlice3D(axesHandle,ct,cubeIdx,plane,ctSlice,cMap,window)</a>
0002 <span class="comment">% matRad function that generates the plot for the CT in the GUI 3D view</span>
0003 <span class="comment">% The function can also be used in personal matlab figures by passing the</span>
0004 <span class="comment">% corresponding axes handle</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% call</span>
0007 <span class="comment">%   [ctHandle,cMap,window] = matRad_plotCtSlice3D(axesHandle,ct,cubeIdx,plane,ctSlice,cMap,window)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% input</span>
0010 <span class="comment">%   axesHandle  handle to 3D axes the slice should be displayed in</span>
0011 <span class="comment">%   ct          the ct struct used in matRad</span>
0012 <span class="comment">%   cubeIdx     Index of the desired cube in the ct struct</span>
0013 <span class="comment">%   plane       plane view (coronal=1,sagittal=2,axial=3)</span>
0014 <span class="comment">%   ctSlice     slice in the selected plane of the 3D cube</span>
0015 <span class="comment">%   cMap        optional argument defining the colormap, default is bone</span>
0016 <span class="comment">%               if you want to use the default map with the window argument</span>
0017 <span class="comment">%               you can use an empty array []</span>
0018 <span class="comment">%   window      optional argument defining the displayed range. default is</span>
0019 <span class="comment">%               [min(ctCube(:)) max(ctCube(:))]</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% output</span>
0022 <span class="comment">%   ctHandle    handle of the plotted CT axes</span>
0023 <span class="comment">%   cMap        used colormap (same as input if set)</span>
0024 <span class="comment">%   window      used window (same as input if set)</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% References</span>
0027 <span class="comment">%   -</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Copyright 2015 the matRad development team.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% This file is part of the matRad project. It is subject to the license</span>
0034 <span class="comment">% terms in the LICENSE file found in the top-level directory of this</span>
0035 <span class="comment">% distribution and at https://github.com/e0404/matRad/LICENSES.txt. No part</span>
0036 <span class="comment">% of the matRad project, including this file, may be copied, modified,</span>
0037 <span class="comment">% propagated, or distributed except according to the terms contained in the</span>
0038 <span class="comment">% LICENSE file.</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0041 
0042 matRad_cfg = MatRad_Config.instance();
0043 
0044 <span class="comment">%Use default colormap?</span>
0045 <span class="keyword">if</span> nargin &lt; 6 || isempty(cMap)
0046     cMap = bone(64);
0047 <span class="keyword">end</span>
0048 
0049 <span class="keyword">if</span> nargin &lt; 7 || isempty(window)
0050     window = [min(ct.cubeHU{cubeIdx}(:)) max(ct.cubeHU{cubeIdx}(:))];    
0051 <span class="keyword">end</span>
0052 
0053 cMapScale = size(cMap,1) - 1;
0054 
0055 <span class="comment">%Create the coordinates</span>
0056 coords{1} = ct.resolution.x * (1:ct.cubeDim(2));
0057 coords{2} = ct.resolution.y * (1:ct.cubeDim(1));
0058 coords{3} = ct.resolution.z * (1:ct.cubeDim(3));
0059  
0060 <span class="comment">% slice plot with surface(...), colormapping can be done by texture</span>
0061 <span class="comment">% mapping, this is why we use surface instead of slice</span>
0062 <span class="keyword">if</span> plane == 1 <span class="comment">% Coronal plane</span>
0063     [xMesh,zMesh] = meshgrid(coords{2},coords{3});
0064     yMesh = ctSlice*ct.resolution.x*ones(size(xMesh));
0065     ctIndexed = uint8(cMapScale*(squeeze((ct.cubeHU{cubeIdx}(ctSlice,:,:)-window(1))/(window(2) - window(1)))));
0066 <span class="comment">%    ct_rgb = permute(ct_rgb,[2 1 3]);</span>
0067 <span class="keyword">elseif</span> plane == 2 <span class="comment">% sagittal plane</span>
0068     [yMesh,zMesh] = meshgrid(coords{1},coords{3});
0069     xMesh = ctSlice*ct.resolution.y*ones(size(yMesh));
0070     ctIndexed = uint8(cMapScale*(squeeze((ct.cubeHU{cubeIdx}(:,ctSlice,:)-window(1))/(window(2) - window(1)))));
0071 <span class="comment">%    ct_rgb = permute(ct_rgb,[2 1 3]);</span>
0072 <span class="keyword">elseif</span> plane == 3 <span class="comment">% Axial plane</span>
0073     [xMesh,yMesh] = meshgrid(coords{2},coords{1});
0074     zMesh = ctSlice*ct.resolution.z*ones(size(xMesh));    
0075     ctIndexed = uint8(cMapScale*(squeeze((ct.cubeHU{cubeIdx}(:,:,ctSlice)-window(1))/(window(2) - window(1)))));
0076 <span class="keyword">else</span>
0077     matRad_cfg.dispError(<span class="string">'Invalid plane ''%d'' selected for visualization!'</span>,plane);
0078 <span class="keyword">end</span>
0079 
0080 <span class="comment">%This circumenvents a bug in Octave when the index in the image hase the maximum value of uint8</span>
0081 <span class="keyword">if</span> matRad_cfg.isOctave
0082     ctIndexed(ctIndexed == 255) = 254;
0083 <span class="keyword">end</span>
0084 
0085 ct_rgb = ind2rgb(ctIndexed,cMap);
0086 
0087 ctHandle = surface(<span class="string">'XData'</span>,xMesh, <span class="string">'YData'</span>,yMesh, <span class="string">'ZData'</span>,zMesh, <span class="keyword">...</span>
0088         <span class="string">'CData'</span>,ct_rgb, <span class="string">'CDataMapping'</span>,<span class="string">'direct'</span>, <span class="keyword">...</span>
0089         <span class="string">'EdgeColor'</span>,<span class="string">'none'</span>, <span class="string">'FaceColor'</span>,<span class="string">'texturemap'</span>, <span class="string">'BackFaceLighting'</span>,<span class="string">'unlit'</span>,<span class="string">'FaceLighting'</span>,<span class="string">'flat'</span>,<span class="string">'Parent'</span>,axesHandle);
0090 
0091 <span class="comment">%{</span>
0092 <span class="comment">% slice plot with slice(...)</span>
0093 <span class="comment">% seems technically more reasonable, however manual colormapping not straightforward</span>
0094 [xMesh,yMesh,zMesh] = meshgrid(coords{:});
0095 slicePlane{1} = [];
0096 slicePlane{2} = [];
0097 slicePlane{3} = [];
0098 
0099 slicePlane{plane} = coords{plane}(ctSlice);
0100 
0101 ct_rgb = ind2rgb(uint8(cMapScale*((ct.cubeHU{cubeIdx}-window(1))/(window(2) - window(1)))),cMap);
0102 
0103 ctHandle = slice(axesHandle,xMesh,yMesh,zMesh,ct.cubeHU{cubeIdx},slicePlane{:});
0104 
0105 set(ctHandle,<span class="string">'EdgeColor'</span>,<span class="string">'none'</span>);
0106 <span class="comment">%}</span>
0107 
0108 
0109 
0110 <span class="keyword">end</span>
0111 
0112 
0113</pre></div>
<hr><address><a href="https://e0404.github.io/matRad/" target="_parent"><img src="https://camo.githubusercontent.com/0a593ef6a04757c975b9f4634f6731ea0b019bbd/68747470733a2f2f7261776769742e636f6d2f77696b692f65303430342f6d61745261642f696d616765732f6d61747261645f626c616e6b2e737667" height="12px"/></a> | Generated by  <a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>